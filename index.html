<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neuron Notes - Облачные заметки</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary: #6366f1; --primary-dark: #4f46e5; --bg: #0f0f23; --card-bg: #1a1b2e; --text: #ffffff; --text-secondary: #a0a0c0; --success: #22c55e; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; }
        .container { display: flex; height: 100%; max-width: 1400px; margin: 0 auto; }
        .sidebar { width: 300px; background: var(--card-bg); padding: 1rem; border-right: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; }
        .main-content { flex: 1; display: flex; flex-direction: column; }
        .header { padding: 1rem 2rem; border-bottom: 1px solid rgba(255,255,255,0.1); display: flex; justify-content: space-between; align-items: center; background: var(--card-bg); }
        .btn { padding: 0.6rem 1.2rem; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; font-weight: 500; border: none; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-save { background: var(--success); color: white; }
        .btn-delete { background: #ef4444; color: white; }
        .notes-list { flex: 1; overflow-y: auto; margin-top: 10px; }
        .note-item { background: rgba(255,255,255,0.03); padding: 1rem; margin-bottom: 0.8rem; border-radius: 10px; cursor: pointer; border: 1px solid rgba(255,255,255,0.05); }
        .note-item.active { border-color: var(--primary); background: rgba(99, 102, 241, 0.1); }
        .editor { flex: 1; display: flex; flex-direction: column; padding: 2rem; }
        .editor-input { border: none; background: transparent; color: var(--text); font-size: 2rem; font-weight: bold; margin-bottom: 1.5rem; outline: none; }
        .editor-textarea { flex: 1; border: none; background: transparent; color: var(--text); font-size: 1.1rem; line-height: 1.6; resize: none; outline: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <div id="sideActions" style="display: none;">
                <button class="btn btn-primary" style="width: 100%;" onclick="createNewNote()">
                    <i class="fas fa-plus"></i> Новая заметка
                </button>
            </div>
            <div class="notes-list" id="notesList"></div>
        </div>

        <div class="main-content">
            <header class="header">
                <h2>Neuron Notes</h2>
                <div id="authActions">
                    <button id="loginBtn" class="btn btn-primary" onclick="login()">Войти</button>
                    <button id="logoutBtn" class="btn btn-delete" style="display:none;" onclick="logout()">Выйти</button>
                </div>
            </header>

            <div id="editorUI" class="editor" style="display: none;">
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 10px;">
                    <button class="btn btn-save" onclick="manualSave()">
                        <i class="fas fa-save"></i> Сохранить в базу
                    </button>
                    <button class="btn btn-delete" onclick="deleteNote()">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <input type="text" id="noteTitle" class="editor-input" placeholder="Заголовок">
                <textarea id="noteContent" class="editor-textarea" placeholder="Ваш текст..."></textarea>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = { 
            apiKey: "AIzaSyDOaDVzzPjyYm4HWMND2XYWjLy_h4wty5s", 
            authDomain: "neuron-ecosystem-2025.firebaseapp.com", 
            projectId: "neuron-ecosystem-2025", 
            storageBucket: "neuron-ecosystem-2025.firebasestorage.app", 
            messagingSenderId: "589834476565", 
            appId: "1:589834476565:web:c9c878a905ecece4dd421c" 
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentNotes = [];
        let currentNoteId = null;

        function login() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
        function logout() { auth.signOut().then(() => location.reload()); }

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('loginBtn').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'block';
                document.getElementById('sideActions').style.display = 'block';
                loadNotes(user.uid);
            }
        });

        function loadNotes(uid) {
            db.collection('users').doc(uid).collection('notes').orderBy('updated', 'desc').onSnapshot(snap => {
                currentNotes = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderNotes();
            });
        }

        function createNewNote() {
            const id = Date.now().toString();
            const note = { title: 'Новая заметка', content: '', updated: Date.now(), type: 'note' };
            db.collection('users').doc(auth.currentUser.uid).collection('notes').doc(id).set(note);
            openNote(id);
        }

        function openNote(id) {
            currentNoteId = id;
            const note = currentNotes.find(n => n.id === id);
            if (!note) return;
            document.getElementById('editorUI').style.display = 'flex';
            document.getElementById('noteTitle').value = note.title;
            document.getElementById('noteContent').value = note.content;
            renderNotes();
        }

        function manualSave() {
            if (!currentNoteId) return;
            db.collection('users').doc(auth.currentUser.uid).collection('notes').doc(currentNoteId).update({
                title: document.getElementById('noteTitle').value,
                content: document.getElementById('noteContent').value,
                updated: Date.now()
            }).then(() => alert("Сохранено в Firebase!"));
        }

        function renderNotes() {
            const list = document.getElementById('notesList');
            list.innerHTML = '';
            currentNotes.forEach(n => {
                const div = document.createElement('div');
                div.className = `note-item ${n.id === currentNoteId ? 'active' : ''}`;
                div.onclick = () => openNote(n.id);
                div.innerHTML = `<strong>${n.title || 'Без названия'}</strong>`;
                list.appendChild(div);
            });
        }

        function deleteNote() {
            if (confirm("Удалить?")) {
                db.collection('users').doc(auth.currentUser.uid).collection('notes').doc(currentNoteId).delete();
                document.getElementById('editorUI').style.display = 'none';
            }
        }
    </script>
</body>
</html>
